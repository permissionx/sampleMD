/* constants */
// L-J parameters for Ne
#define LJ_EPSILON 0.0031
#define LJ_SIGMA 2.74
#define LJ_2_EPSILON 0.0062                     // 4 * LJ_EPSILON
#define LJ_24_EPSILON_SIGMA_6 31.48301472289983 // 24 * LJ_EPSILON * pow(LJ_SIGMA, 6)
#define LJ_2_SIGMA_6 846.3176000779524          // 2 * pow(LJ_SIGMA, 6)
#define LJ_CUTOFF 5.0

struct Atom
{
    int id, type;
    double r[3];
    double reR[3];
    double boxReR[3];
    int neighborNumber;
    struct AtomNeighbor neighbors[MAX_NEIGHBOR_NUMBER];
    double force[3];
    double potentialEnergy;
};

/* global variables */
double totalPotentialEnergy;

/* function declarations */
void Potential_LJ(int isEnergy, int isForce);

/* functions */
void Potential_LJ(int isEnergy, int isForce)
{
    int i, j, d;
    double distance;
    double tmpEnergy, tmpForce;

    if (isEnergy)
        totalPotentialEnergy = 0;
    for (i = 0; i < atomNumber; i++)
    {
        if (isEnergy)
            atoms[i].potentialEnergy = 0;
        if (isForce)
        {
            atoms[i].force[0] = 0;
            atoms[i].force[1] = 0;
            atoms[i].force[2] = 0;
        }
        for (j = 0; j < atoms[i].neighborNumber; j++)
        {
            distance = atoms[i].neighbors[j].distance;
            if (distance > LJ_CUTOFF)
            {
                continue;
            }
            if (isEnergy)
            {
                tmpEnergy = LJ_2_EPSILON * (pow((LJ_SIGMA / distance), 12.) - pow((LJ_SIGMA / distance), 6.));
                atoms[i].potentialEnergy += tmpEnergy;
                totalPotentialEnergy += tmpEnergy;
            }
            if (isForce)
            {
                tmpForce = LJ_2_SIGMA_6 / pow(distance, 14) - 1 / pow(distance, 8);
                for (d = 0; d < 3; d++)
                {
                    atoms[i].force[d] -= tmpForce * atoms[i].neighbors[j].dr[d];
                }
            }
        }
        if (isForce)
        {
            for (d = 0; d < 3; d++)
            {
                atoms[i].force[d] *= LJ_24_EPSILON_SIGMA_6;
            }
        }
    }
}

/* main */
int main()
{
    /* parameters */
    neighborCutoff = 5.0;

    atomNumber = 2;
    atoms[0].r[0] = 0;
    atoms[0].r[1] = 0;
    atoms[0].r[2] = 0;
    atoms[0].type = 1;
    atoms[0].id = 0;
    atoms[1].r[1] = 0;
    atoms[1].r[2] = 0;
    atoms[0].type = 1;
    atoms[1].id = 1;

    boxStartPoint[0] = 0;
    boxStartPoint[1] = 0;
    boxStartPoint[2] = 0;
    boxTranVecs[0][0] = 100;
    boxTranVecs[0][1] = 0;
    boxTranVecs[0][2] = 0;
    boxTranVecs[1][0] = 0;
    boxTranVecs[1][1] = 1;
    boxTranVecs[1][2] = 0;
    boxTranVecs[2][0] = 0;
    boxTranVecs[2][1] = 0;
    boxTranVecs[2][2] = 1;
    boxPerpendicular = 1;

    /* processing and output*/
    double r;

    printf("r(A) potentialEnergy(eV) force(eV/A)\n");
    for (r = 2.55; r < 5.0; r += 0.01)
    {
        atoms[1].r[0] = r;
        ConstructNeighborList();
        Potential_LJ(1, 1);
        printf("%f %f %f\n", r, totalPotentialEnergy, atoms[1].force[0]);
    }
    return 0;
}

/* output
r(A) potentialEnergy(eV) force(eV/A)
2.550000 0.010288 0.093320
2.560000 0.009384 0.087677
2.570000 0.008534 0.082361
2.580000 0.007735 0.077353
2.590000 0.006986 0.072635
2.600000 0.006282 0.068190
2.610000 0.005621 0.064002
2.620000 0.005001 0.060055
2.630000 0.004419 0.056336
2.640000 0.003873 0.052831
2.650000 0.003362 0.049528
2.660000 0.002882 0.046415
2.670000 0.002433 0.043480
2.680000 0.002012 0.040714
2.690000 0.001618 0.038108
2.700000 0.001249 0.035650
2.710000 0.000905 0.033334
2.720000 0.000582 0.031151
2.730000 0.000281 0.029093
2.740000 0.000000 0.027153
2.750000 -0.000262 0.025325
2.760000 -0.000507 0.023602
2.770000 -0.000735 0.021978
2.780000 -0.000947 0.020447
2.790000 -0.001144 0.019005
2.800000 -0.001327 0.017645
2.810000 -0.001497 0.016365
2.820000 -0.001655 0.015158
2.830000 -0.001800 0.014021
2.840000 -0.001935 0.012950
2.850000 -0.002060 0.011942
2.860000 -0.002174 0.010992
2.870000 -0.002280 0.010097
2.880000 -0.002376 0.009255
2.890000 -0.002465 0.008463
2.900000 -0.002546 0.007717
2.910000 -0.002619 0.007015
2.920000 -0.002686 0.006354
2.930000 -0.002747 0.005733
2.940000 -0.002801 0.005149
2.950000 -0.002850 0.004600
2.960000 -0.002893 0.004085
2.970000 -0.002932 0.003600
2.980000 -0.002965 0.003145
2.990000 -0.002995 0.002718
3.000000 -0.003020 0.002317
3.010000 -0.003041 0.001941
3.020000 -0.003059 0.001588
3.030000 -0.003073 0.001257
3.040000 -0.003084 0.000948
3.050000 -0.003092 0.000658
3.060000 -0.003097 0.000387
3.070000 -0.003100 0.000133
3.080000 -0.003100 -0.000104
3.090000 -0.003098 -0.000325
3.100000 -0.003093 -0.000531
3.110000 -0.003087 -0.000723
3.120000 -0.003079 -0.000903
3.130000 -0.003069 -0.001069
3.140000 -0.003058 -0.001224
3.150000 -0.003045 -0.001368
3.160000 -0.003030 -0.001501
3.170000 -0.003015 -0.001624
3.180000 -0.002998 -0.001739
3.190000 -0.002980 -0.001844
3.200000 -0.002961 -0.001941
3.210000 -0.002941 -0.002030
3.220000 -0.002920 -0.002112
3.230000 -0.002899 -0.002186
3.240000 -0.002877 -0.002255
3.250000 -0.002854 -0.002317
3.260000 -0.002830 -0.002373
3.270000 -0.002806 -0.002424
3.280000 -0.002782 -0.002469
3.290000 -0.002757 -0.002510
3.300000 -0.002732 -0.002546
3.310000 -0.002706 -0.002578
3.320000 -0.002680 -0.002606
3.330000 -0.002654 -0.002630
3.340000 -0.002628 -0.002651
3.350000 -0.002601 -0.002668
3.360000 -0.002574 -0.002682
3.370000 -0.002547 -0.002693
3.380000 -0.002520 -0.002701
3.390000 -0.002493 -0.002707
3.400000 -0.002466 -0.002710
3.410000 -0.002439 -0.002711
3.420000 -0.002412 -0.002710
3.430000 -0.002385 -0.002707
3.440000 -0.002358 -0.002702
3.450000 -0.002331 -0.002696
3.460000 -0.002304 -0.002687
3.470000 -0.002277 -0.002678
3.480000 -0.002250 -0.002667
3.490000 -0.002224 -0.002654
3.500000 -0.002197 -0.002640
3.510000 -0.002171 -0.002626
3.520000 -0.002145 -0.002610
3.530000 -0.002119 -0.002593
3.540000 -0.002093 -0.002576
3.550000 -0.002067 -0.002557
3.560000 -0.002042 -0.002538
3.570000 -0.002017 -0.002518
3.580000 -0.001991 -0.002498
3.590000 -0.001967 -0.002477
3.600000 -0.001942 -0.002456
3.610000 -0.001917 -0.002434
3.620000 -0.001893 -0.002411
3.630000 -0.001869 -0.002389
3.640000 -0.001845 -0.002366
3.650000 -0.001822 -0.002342
3.660000 -0.001799 -0.002319
3.670000 -0.001776 -0.002295
3.680000 -0.001753 -0.002271
3.690000 -0.001730 -0.002247
3.700000 -0.001708 -0.002222
3.710000 -0.001686 -0.002198
3.720000 -0.001664 -0.002174
3.730000 -0.001642 -0.002149
3.740000 -0.001621 -0.002125
3.750000 -0.001600 -0.002100
3.760000 -0.001579 -0.002076
3.770000 -0.001558 -0.002051
3.780000 -0.001538 -0.002027
3.790000 -0.001518 -0.002002
3.800000 -0.001498 -0.001978
3.810000 -0.001478 -0.001954
3.820000 -0.001459 -0.001930
3.830000 -0.001440 -0.001906
3.840000 -0.001421 -0.001882
3.850000 -0.001402 -0.001858
3.860000 -0.001383 -0.001835
3.870000 -0.001365 -0.001812
3.880000 -0.001347 -0.001788
3.890000 -0.001329 -0.001765
3.900000 -0.001312 -0.001742
3.910000 -0.001295 -0.001720
3.920000 -0.001277 -0.001697
3.930000 -0.001261 -0.001675
3.940000 -0.001244 -0.001653
3.950000 -0.001228 -0.001631
3.960000 -0.001211 -0.001609
3.970000 -0.001195 -0.001588
3.980000 -0.001180 -0.001566
3.990000 -0.001164 -0.001545
4.000000 -0.001149 -0.001525
4.010000 -0.001134 -0.001504
4.020000 -0.001119 -0.001484
4.030000 -0.001104 -0.001463
4.040000 -0.001089 -0.001443
4.050000 -0.001075 -0.001424
4.060000 -0.001061 -0.001404
4.070000 -0.001047 -0.001385
4.080000 -0.001033 -0.001366
4.090000 -0.001020 -0.001347
4.100000 -0.001006 -0.001329
4.110000 -0.000993 -0.001310
4.120000 -0.000980 -0.001292
4.130000 -0.000967 -0.001274
4.140000 -0.000955 -0.001256
4.150000 -0.000942 -0.001239
4.160000 -0.000930 -0.001222
4.170000 -0.000918 -0.001205
4.180000 -0.000906 -0.001188
4.190000 -0.000894 -0.001171
4.200000 -0.000882 -0.001155
4.210000 -0.000871 -0.001139
4.220000 -0.000859 -0.001123
4.230000 -0.000848 -0.001107
4.240000 -0.000837 -0.001092
4.250000 -0.000826 -0.001077
4.260000 -0.000816 -0.001061
4.270000 -0.000805 -0.001047
4.280000 -0.000795 -0.001032
4.290000 -0.000785 -0.001017
4.300000 -0.000775 -0.001003
4.310000 -0.000765 -0.000989
4.320000 -0.000755 -0.000975
4.330000 -0.000745 -0.000962
4.340000 -0.000735 -0.000948
4.350000 -0.000726 -0.000935
4.360000 -0.000717 -0.000922
4.370000 -0.000708 -0.000909
4.380000 -0.000699 -0.000896
4.390000 -0.000690 -0.000883
4.400000 -0.000681 -0.000871
4.410000 -0.000672 -0.000859
4.420000 -0.000664 -0.000847
4.430000 -0.000655 -0.000835
4.440000 -0.000647 -0.000823
4.450000 -0.000639 -0.000812
4.460000 -0.000631 -0.000800
4.470000 -0.000623 -0.000789
4.480000 -0.000615 -0.000778
4.490000 -0.000607 -0.000767
4.500000 -0.000600 -0.000757
4.510000 -0.000592 -0.000746
4.520000 -0.000585 -0.000736
4.530000 -0.000577 -0.000725
4.540000 -0.000570 -0.000715
4.550000 -0.000563 -0.000705
4.560000 -0.000556 -0.000696
4.570000 -0.000549 -0.000686
4.580000 -0.000542 -0.000676
4.590000 -0.000536 -0.000667
4.600000 -0.000529 -0.000658
4.610000 -0.000523 -0.000649
4.620000 -0.000516 -0.000640
4.630000 -0.000510 -0.000631
4.640000 -0.000504 -0.000622
4.650000 -0.000497 -0.000614
4.660000 -0.000491 -0.000605
4.670000 -0.000485 -0.000597
4.680000 -0.000479 -0.000589
4.690000 -0.000473 -0.000581
4.700000 -0.000468 -0.000573
4.710000 -0.000462 -0.000565
4.720000 -0.000456 -0.000557
4.730000 -0.000451 -0.000549
4.740000 -0.000445 -0.000542
4.750000 -0.000440 -0.000535
4.760000 -0.000435 -0.000527
4.770000 -0.000429 -0.000520
4.780000 -0.000424 -0.000513
4.790000 -0.000419 -0.000506
4.800000 -0.000414 -0.000499
4.810000 -0.000409 -0.000492
4.820000 -0.000404 -0.000486
4.830000 -0.000400 -0.000479
4.840000 -0.000395 -0.000473
4.850000 -0.000390 -0.000466
4.860000 -0.000385 -0.000460
4.870000 -0.000381 -0.000454
4.880000 -0.000376 -0.000448
4.890000 -0.000372 -0.000442
4.900000 -0.000368 -0.000436
4.910000 -0.000363 -0.000430
4.920000 -0.000359 -0.000424
4.930000 -0.000355 -0.000419
4.940000 -0.000351 -0.000413
4.950000 -0.000346 -0.000407
4.960000 -0.000342 -0.000402
4.970000 -0.000338 -0.000397
4.980000 -0.000334 -0.000391
4.990000 -0.000331 -0.000386
5.000000 -0.000327 -0.000381
*/